# AI-Powered Cloud SA Assistant Configuration Template
# Copy this file to config.yaml and fill in your values
# Environment variables will override these values with SA_ASSISTANT_ prefix
# For example: SA_ASSISTANT_OPENAI_APIKEY or use standard names like OPENAI_API_KEY

# OpenAI Configuration (REQUIRED)
openai:
  # OpenAI API Key - REQUIRED
  # Environment variable: OPENAI_API_KEY or SA_ASSISTANT_OPENAI_APIKEY
  apikey: "sk-..."  # pragma: allowlist secret

  # OpenAI API Endpoint - Optional, defaults to official OpenAI endpoint
  # Environment variable: OPENAI_ENDPOINT or SA_ASSISTANT_OPENAI_ENDPOINT
  endpoint: "https://api.openai.com/v1"

# Microsoft Teams Configuration (REQUIRED)
teams:
  # Teams Webhook URL - REQUIRED for bot functionality
  # Environment variable: TEAMS_WEBHOOK_URL or SA_ASSISTANT_TEAMS_WEBHOOK_URL
  #
  # To get your webhook URL:
  # 1. Go to your Teams channel
  # 2. Click "..." â†’ "Workflows"
  # 3. Select "Post to a channel when a webhook request is received"
  # 4. Copy the generated webhook URL
  #
  # Example formats:
  # - Teams Incoming Webhook: https://your-tenant.webhook.office.com/webhookb2/...
  # - Logic Apps Webhook: https://prod-XX.region.logic.azure.com:443/workflows/...
  webhook_url: "https://your-org.webhook.office.com/webhookb2/..."  # pragma: allowlist secret

# Internal Service URLs - Used for microservice communication
# Environment variables: SA_ASSISTANT_SERVICES_*
services:
  # Retrieval service endpoint
  retrieve_url: "http://retrieve:8081"

  # Web search service endpoint
  websearch_url: "http://websearch:8083"

  # Synthesis service endpoint
  synthesize_url: "http://synthesize:8082"

# ChromaDB Configuration
# Environment variables: SA_ASSISTANT_CHROMA_*
chroma:
  # ChromaDB server URL
  # Environment variable: CHROMA_URL or SA_ASSISTANT_CHROMA_URL
  url: "http://chromadb:8000"

  # ChromaDB collection name for storing embeddings
  collection_name: "cloud_assistant"

# Metadata Database Configuration
# Environment variables: SA_ASSISTANT_METADATA_*
metadata:
  # SQLite database path for metadata storage
  # Environment variable: METADATA_DB_PATH or SA_ASSISTANT_METADATA_DB_PATH
  db_path: "/app/data/metadata.db"

# Retrieval Engine Configuration
# Environment variables: SA_ASSISTANT_RETRIEVAL_*
retrieval:
  # Maximum number of chunks to retrieve for context
  # Must be greater than 0
  max_chunks: 5

  # Minimum number of chunks before triggering fallback search
  # Must be greater than or equal to 0
  fallback_threshold: 3

  # Minimum confidence threshold for chunk relevance
  # Must be between 0 and 1
  confidence_threshold: 0.7

# Web Search Configuration
# Environment variables: SA_ASSISTANT_WEBSEARCH_*
websearch:
  # Maximum number of web search results to include
  # Must be greater than 0
  max_results: 3

  # Keywords that trigger web search for fresh content
  freshness_keywords:
    - "latest"
    - "recent"
    - "update"
    - "new"
    - "current"
    - "announced"
    - "release"
    - "breaking"
    - "Q1 2025"
    - "Q2 2025"
    - "Q3 2025"
    - "Q4 2025"
    - "January 2025"
    - "February 2025"
    - "March 2025"
    - "April 2025"
    - "May 2025"
    - "June 2025"
    - "July 2025"
    - "August 2025"
    - "September 2025"
    - "October 2025"
    - "November 2025"
    - "December 2025"
    - "2025"
    - "2024"
    - "reinvent"
    - "ignite"
    - "build"
    - "connect"
    - "summit"
    - "conference"
    - "preview"
    - "beta"
    - "alpha"
    - "ga"
    - "general availability"
    - "compliance feature"
    - "security update"
    - "patch"
    - "hotfix"
    - "vulnerability"
    - "advisory"

# AI Synthesis Configuration
# Environment variables: SA_ASSISTANT_SYNTHESIS_*
synthesis:
  # OpenAI model to use for synthesis
  # Recommended: gpt-4o, gpt-4o-mini for cost optimization
  model: "gpt-4o"

  # Maximum tokens in generated response
  # Must be greater than 0
  # Increased from 2000 to 4000 to support code generation and architecture diagrams
  max_tokens: 4000

  # Temperature for response generation (creativity vs consistency)
  # Must be between 0 and 2 (0 = more deterministic, 2 = more creative)
  temperature: 0.3

  # Request timeout in seconds for standard queries
  # Must be greater than 0
  timeout_seconds: 30

  # Request timeout in seconds for complex queries (migration, architecture, etc.)
  # Must be greater than 0
  complex_timeout_seconds: 60

  # Maximum retry attempts for failed requests
  # Must be greater than 0
  max_retries: 3

  # Base delay for exponential backoff (in seconds)
  # Must be greater than 0
  base_delay: 1.0

  # Multiplier for exponential backoff
  # Must be greater than 1
  backoff_multiplier: 2.0

# Diagram Rendering Configuration
# Environment variables: SA_ASSISTANT_DIAGRAM_*
diagram:
  # Mermaid.ink API endpoint for diagram rendering
  # Environment variable: SA_ASSISTANT_DIAGRAM_MERMAID_INK_URL
  mermaid_ink_url: "https://mermaid.ink/img"

  # HTTP timeout for diagram rendering requests (in seconds)
  # Must be greater than 0
  # Environment variable: SA_ASSISTANT_DIAGRAM_TIMEOUT_SECONDS
  timeout_seconds: 30

  # Cache expiry time for rendered diagrams (in hours)
  # Must be greater than 0
  # Environment variable: SA_ASSISTANT_DIAGRAM_CACHE_EXPIRY_HOURS
  cache_expiry_hours: 24

  # Enable/disable diagram caching for performance
  # Environment variable: SA_ASSISTANT_DIAGRAM_ENABLE_CACHING
  enable_caching: true

  # Maximum size of diagram code in bytes
  # Must be greater than 0
  # Environment variable: SA_ASSISTANT_DIAGRAM_MAX_DIAGRAM_SIZE
  max_diagram_size: 10240

# Logging Configuration
# Environment variables: SA_ASSISTANT_LOGGING_* or LOG_*
logging:
  # Log level: debug, info, warn, error
  # Environment variable: LOG_LEVEL or SA_ASSISTANT_LOGGING_LEVEL
  level: "info"

  # Log format: json, text
  # Environment variable: LOG_FORMAT or SA_ASSISTANT_LOGGING_FORMAT
  format: "json"

  # Log output: stdout, file
  # Environment variable: LOG_OUTPUT or SA_ASSISTANT_LOGGING_OUTPUT
  output: "stdout"

# Feedback Storage Configuration
# Environment variables: SA_ASSISTANT_FEEDBACK_*
feedback:
  # Storage type: file, sqlite
  storage_type: "file"

  # File path for file-based feedback storage
  file_path: "./feedback.log"

  # SQLite database path for sqlite-based feedback storage
  db_path: "./feedback.db"

# Session Management Configuration
# Environment variables: SA_ASSISTANT_SESSION_*
session:
  # Storage type: memory, redis
  # memory: In-memory storage (lost on restart)
  # redis: Redis-based persistent storage
  # Environment variable: SA_ASSISTANT_SESSION_STORAGE_TYPE
  storage_type: "memory"

  # Redis URL for redis storage type
  # Environment variable: SA_ASSISTANT_SESSION_REDIS_URL
  redis_url: "redis://localhost:6379"

  # Default session TTL in minutes
  # How long sessions persist without activity
  # Environment variable: SA_ASSISTANT_SESSION_DEFAULT_TTL_MINUTES
  default_ttl_minutes: 1440  # 24 hours

  # Maximum number of sessions to maintain
  # Environment variable: SA_ASSISTANT_SESSION_MAX_SESSIONS
  max_sessions: 10000

  # Cleanup interval for expired sessions in minutes
  # Environment variable: SA_ASSISTANT_SESSION_CLEANUP_INTERVAL_MINUTES
  cleanup_interval_minutes: 60  # 1 hour

  # Maximum conversation history length to include in prompts
  # Environment variable: SA_ASSISTANT_SESSION_MAX_HISTORY_LENGTH
  max_history_length: 20

  # Enable conversation management API endpoints
  # Environment variable: SA_ASSISTANT_SESSION_ENABLE_CONVERSATION_API
  enable_conversation_api: true

# Development & Production Profiles
# The configuration system automatically detects environment via:
# ENVIRONMENT or ENV environment variables
# Default: development

# Development-specific overrides (when ENVIRONMENT=development)
# These values are automatically applied in development mode
development:
  logging:
    level: "debug"
    format: "text"

  synthesis:
    temperature: 0.1  # More deterministic for testing

# Production-specific overrides (when ENVIRONMENT=production)
# These values are automatically applied in production mode
production:
  logging:
    level: "info"
    format: "json"

  synthesis:
    temperature: 0.3  # Balanced for production use

  session:
    storage_type: "redis"  # Use Redis for persistence in production
    default_ttl_minutes: 2880  # 48 hours for production
    cleanup_interval_minutes: 30  # More frequent cleanup

# Environment Variable Quick Reference:
# ====================================
# Required:
#   OPENAI_API_KEY - OpenAI API key
#   TEAMS_WEBHOOK_URL - Microsoft Teams webhook URL (see Teams section above for setup)
#
# Quick Setup:
#   export OPENAI_API_KEY="sk-..."
#   export TEAMS_WEBHOOK_URL="https://your-webhook-url..."
#   docker-compose up -d
#
# Optional:
#   CONFIG_PATH - Custom configuration file path
#   ENVIRONMENT - Environment profile (development, production)
#   LOG_LEVEL - Logging level (debug, info, warn, error)
#   LOG_FORMAT - Logging format (json, text)
#   LOG_OUTPUT - Logging output (stdout, file)
#   CHROMA_URL - ChromaDB server URL
#   METADATA_DB_PATH - Metadata database path
#
# Service Discovery:
#   SA_ASSISTANT_SERVICES_RETRIEVE_URL - Retrieval service URL
#   SA_ASSISTANT_SERVICES_WEBSEARCH_URL - Web search service URL
#   SA_ASSISTANT_SERVICES_SYNTHESIZE_URL - Synthesis service URL
#
# Session Management:
#   SA_ASSISTANT_SESSION_STORAGE_TYPE - Session storage backend (memory, redis)
#   SA_ASSISTANT_SESSION_REDIS_URL - Redis connection URL for persistent sessions
#   SA_ASSISTANT_SESSION_DEFAULT_TTL_MINUTES - Session timeout in minutes
#   SA_ASSISTANT_SESSION_MAX_SESSIONS - Maximum number of concurrent sessions
#   SA_ASSISTANT_SESSION_CLEANUP_INTERVAL_MINUTES - Cleanup frequency
#   SA_ASSISTANT_SESSION_MAX_HISTORY_LENGTH - Max conversation history length
#   SA_ASSISTANT_SESSION_ENABLE_CONVERSATION_API - Enable conversation endpoints
#
# Diagram Rendering:
#   SA_ASSISTANT_DIAGRAM_MERMAID_INK_URL - Mermaid.ink API endpoint
#   SA_ASSISTANT_DIAGRAM_TIMEOUT_SECONDS - Rendering timeout
#   SA_ASSISTANT_DIAGRAM_CACHE_EXPIRY_HOURS - Cache expiry time
#   SA_ASSISTANT_DIAGRAM_ENABLE_CACHING - Enable caching
#   SA_ASSISTANT_DIAGRAM_MAX_DIAGRAM_SIZE - Maximum diagram size
#
# All configuration values can be overridden with environment variables using
# the SA_ASSISTANT_ prefix and replacing dots with underscores.
# Example: openai.apikey -> SA_ASSISTANT_OPENAI_APIKEY
